<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">
    <head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

        <title th:replace ="fragments/frag :: css"></title>
        
        <style>
                .radio {
                    padding-left: 20px; }
                .radio label {
                    display: inline-block;
                    position: relative;
                    padding-left: 5px; }
        </style>
        
    </head>

<body>
    <div id="wrapper">
        <!--navigation-->
        <div th:replace="fragments/frag :: nav"></div>
        <div id="page-wrapper">

                <div class="container-fluid s_pageWrap">

                    <!-- Page Heading -->
                    <div class="row">
                        <div class="col-lg-12">
                            <h2 class="page-header">
                                SMS Group 
                                <!--<small>Spice 1</small>-->
                            </h2>
                            <ol class="breadcrumb">
                                <li>
                                    <i class="fa fa-dashboard"></i>  <a href="index.html">Home</a>
                                </li>
                                <li class="active">
                                   <i class="glyphicon glyphicon-phone"></i> <a href="#">Sms Group</a>
                                </li>
                            </ol>
                        </div>
                            

                        <!--------------- main body content ----------------->
                        <div class="row s_row">
                            <div class="col-md-12">
                                <div class="panel panel-default">
                                    <div class="panel-body">    
                                        <!--------------- content ----------------->
                                        <div class="row">
                                            <div class="col-md-12">
<!--                                                <h2 id="grid-nesting">
                                                    SMS Group Setup
                                                </h2>-->
                                                <div class="container-fluid">	
                                                        <!--container of the SMS group-->
                                                            <div class="row">
                                                                <!-- left box -->
                                                                <div class="col-md-6">
                                                                    <div class="panel panel-default">
                                                                        <div class="panel-body">
                                                                            
                                                                                <!--<table class="table table-striped table-bordered" id="dataTables-recordList">-->
                                                                                <table class="table table-striped display" cellspacing="0" width="100%" id="dataTables-recordList">
                                                                                        <thead>
                                                                                            <tr class="success">
                                                                                                <th width="70%">Group Name</th>
                                                                                                <th></th>
                                                                                                <th></th>
                                                                                            </tr>
                                                                                        </thead>
                                                                                        <tbody>
                                                                                            <tr class="odd gradeX" th:each="tempData : ${smsGrpDataList}">
                                                                                                <td th:text="${tempData.SMSGroupName}">Trident</td>
                                                                                                <td><button type = "button" class = "btn btn-warning col-xs-12" th:onclick="'getThisId('+${tempData.SMSGroupsID}+')'">Edit</button></td>
                                                                                                <td><button type = "button" class = "btn btn-danger col-xs-12"
                                                                                                    data-toggle="modal" data-target="#deletePop"
                                                                                                    th:onclick="'vaDelete('+${tempData.SMSGroupsID}+')'">Delete</button></td>
                                                                                            </tr>
                                                                                        </tbody>
                                                                                </table>
                                                                                <!-- /.table-responsive -->
                                                                            
                                                                            
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                
                                                                <!-- right box -->
                                                                <div class="col-md-6">
                                                                    <div class="panel panel-default">
                                                                        <div class="panel-body">
                                                                            
                                                                            <!--FORM-->
                                                                            <form id="thisForm">
                                                                                <div class="row container-fluid" style="background-color:#f2f2f2; padding-top:10px;">
                                                                                    <div class="col-md-12">
                                                                                        <div class="form-group numberTextBox">
                                                                                            <label for="txtlabel">Group Name<span class="mandatory">*</span></label>
                                                                                            <input type="hidden" id="grpId" name="grpId" value="" >
                                                                                            <input type="text" class="form-control" id="gpName" name="gpName" placeholder="Enter Group Name" required>
                                                                                        </div>
                                                                                    </div>
                                                                                    <div class="col-md-6" style="display:none;">
                                                                                        <div class="form-group">
                                                                                            <label for="txtlabel">Designation<span class="mandatory"></span></label>
                                                                                            <select class="form-control" id="designation" name="designation" onchange="loadStaff();">
                                                                                                <option value =" ">Select Name...</option>
                                                                                                <option th:each="tempData : ${designationDataList}" 
                                                                                                th:value="${tempData.DesignationID}" 
                                                                                                th:text="${tempData.Name}" th:select="${tempData.DesignationID}">Select Name...</option>
                                                                                            </select>
                                                                                        </div>
                                                                                    </div>
                                                                                    <div class="col-md-12">
                                                                                        <div class="col-md-4 col-xs-12">
                                                                                            <div class="radio radio-primary">
                                                                                                <input type="radio" name="radiolevel" id="radio1" value="1" checked>
                                                                                                    <label for="radio1">
                                                                                                        Group A
                                                                                                    </label>
                                                                                            </div>
                                                                                        </div>
                                                                                        <div class="col-md-4 col-xs-12">
                                                                                            <div class="radio radio-primary">
                                                                                                <input type="radio" name="radiolevel" id="radio2" value="2">
                                                                                                <label for="radio2">
                                                                                                     Group B
                                                                                                </label>
                                                                                            </div>
                                                                                        </div>
                                                                                        <div class="col-md-4 col-xs-12">
                                                                                            <div class="radio radio-primary">
                                                                                                <input type="radio" name="radiolevel" id="radio3" value="3">
                                                                                                <label for="radio3">
                                                                                                     Group C
                                                                                                </label>
                                                                                            </div>
                                                                                        </div> 
                                                                                    </div>

                                                                                    <div class="row">
                                                                                        <div class="col-md-12">
                                                                                            <div class="col-md-8">
                                                                                                <div class="form-group">
                                                                                                    <label for="txtlabel">Person Name<span class="mandatory">*</span></label>
                                                                                                    <select class="form-control" id="pName" name="pName" required>
                                                                                                        <option value ="">---Select Staff---</option>
                                                                                                        <option th:each="recData : ${staffDataList}"  th:text="${recData.Name}" th:value="${recData.StaffID}" ></option>
                                                                                                        
                                                                                                        
                                                                                                    </select>
                                                                                                </div>
                                                                                            </div>
                                                                                        <div class="col-md-4">
                                                                                             <label for="txtlabel" style="color:white;">*</label>
                                                                                            <div class="form-group">
                                                                                                <button type="button" class="btn btn-primary" style="width:100%;" id="idAdd" onclick="addStaffToGroup()">ADD</button>
                                                                                            </div>
                                                                                        </div>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </form>
                                                                            
                                                                            <br/>
                                                                                <div class="container-fluid">
                                                                                    <table class="table table-striped display" cellspacing="0" width="100%" id="datatables-nameList">
                                                                                            <thead>
                                                                                                <tr class="success">
                                                                                                    <th>Names</th>
                                                                                                    <th></th>
                                                                                                </tr>
                                                                                            </thead>
                                                                                            <tbody id="tstaffIfdGroup">
                                                                                            </tbody>
                                                                                    </table>
                                                                                </div>
                                                                                
                                                                        </div>
                                                                        <!--Panel body-->
                                                                    </div>
                                                                    <!-- panel default-->
                                                                    
                                                                    <div class="row">
                                                                        <div class="container-fluid">
                                                                                <button type="button" class="btn btn-success col-md-4 col-xs-12 pull-right" onclick="saveSMSGroup()" >SAVE</button>
                                                                        </div>
                                                                    </div>
                                                                    
                                                                </div>
                                                                <!-- end col 6 -->
                                                                
                                                            </div>
                                                            <!-- end div row-->
                                                </div>
                                               <!-- end container of the SMS group-->

                                            </div>
                                                
                                        </div>
                                        
                                        <!-------------- end content ----------------->
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--------------- end main body content ----------------->
                       
                        
                    </div>
                    <!-- /.row -->

                </div>
                <!-- /.container-fluid -->

        </div>
            <!-- /#page-wrapper -->
    </div>
    
     <!--get ID's hidden-->
    <input type='hidden' id="tmpGetID" name="tmpGetID" />
    
     <!--MODAL SECTION--> 
    <div class="modal fade" id="SavePop" role="dialog">
        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Alert</h4>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <span>
                            Save Successful!
                        </span>
                    </div>
                </div>
                <div class="modal-footer">
                    <!--<button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>-->
                    <button type="button" class="btn btn-success" data-dismiss="modal">OK</button>
                </div>
            </div>
        </div>
    </div>
    <!--end MODAL SECTION--> 
    
    
    <!--MODAL SECTION--> 
    <div class="modal fade" id="SavePop" role="dialog">
        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Alert</h4>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <span>
                            Save Successful!
                        </span>
                    </div>
                </div>
                <div class="modal-footer">
                    <!--<button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>-->
                    <button type="button" class="btn btn-success" data-dismiss="modal">OK</button>
                </div>
            </div>
        </div>
    </div>
    <!--end MODAL SECTION--> 
    
    <!--MODAL SECTION Save pop--> 
    <div class="modal fade" id="AddGroup" role="dialog">
        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Select Access Group</h4>
                </div>
                <div class="modal-body">
                    <div class="form-group">

                        <div style="max-height: 200px; overflow:auto;">
                            <table  class="table-striped table-hover" width="100%">
                                <tbody>
                                    <tr>
                                        <td>
                                            <div class="checkbox">
                                                <label>
                                                    <input type="checkbox"> Door Group 1
                                                </label>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="checkbox">
                                                <label>
                                                    <input type="checkbox">  Door Group 2
                                                </label>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>                                           


                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-success" data-dismiss="modal">Apply</button>
                </div>
            </div>
        </div>
    </div>
    <!--end MODAL SECTION--> 
    
    <!--VALIDATE DELETE OR NOT--> 
    <div class="modal fade" id="deletePop" role="dialog">
        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Alert!</h4>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <span>
                            Delete this record?
                            <input type='hidden' id="getID" name="getID">
                        </span>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">CANCEL</button>
                    <button type="button" class="btn btn-danger" data-dismiss="modal" onclick='deleteRecord()'>DELETE</button>
                </div>
            </div>
        </div>
    </div>
    
    
    <!-- /#wrapper -->
    <!-- script -->
    <div th:replace ="fragments/frag :: script"></div>
    <script th:inline="javascript">
        /*<![CDATA[*/
            var tempStaffGroup = {};
            
            
            $(document).ready(function(){
                    $('#dataTables-recordList').DataTable( {
                           responsive: true,
                           scrollY:        '44vh',
                           scrollCollapse: true,
                           paging:         false
                       });    
    
                    $('#datatables-nameList').DataTable ({
                           responsive: true,
                           searching: false,
                           scrollY:        '23vh',
                           scrollCollapse: true,
                           paging:         false
                    });
                    
        
                // validation forma
                $('#thisForm').bootstrapValidator({
                    excluded: ':disabled',
                    feedbackIcons: {
                        //valid: 'glyphicon glyphicon-ok',
                        //invalid: 'glyphicon glyphicon-remove',
                        validating: 'glyphicon glyphicon-refresh'
                    },
                    fields: {
                            gpName: {
                                validators: {
                                    notEmpty: {
                                        message: 'Please enter group name'
                                    }
                                }
                            },
                            designation: {
                                validators: {
                                    notEmpty: {
                                        message: 'Please select designation'
                                    }
                                }
                            },
                            pName: {
                                validators: {
                                    notEmpty: {
                                        message: 'Please select name'
                                    }
                                }
                            }
                            
                            
                        }   
                    });
        
            });
            
            function getThisId(x) {
                console.log("You click edit button Id:"+ x);
                
                OperationDwr.getSMSGroups(x, function(data) {
//                    console.log("DWR CALL");

                    $("#grpId").val( data.SMSGroupsID );
                    $("#gpName").val( data.SMSGroupName );
                    $("#radio"+data.GroupLevel).prop("checked",true); 

                    console.log("data.StaffData:"+data.Staff);    
                    console.log("data.StaffData.length:"+data.Staff.length);    
                    

                    var size_ = Object.keys(tempStaffGroup).length;
                    console.log("size:"+size_);
                    try{
                        
                            $("#datatables-nameList").find('tbody').empty(); 
                            $("#tstaffIfdGroup").empty();

                            tempStaffGroup = {};
                    }catch(err){}    
                    
                    
                    for(var x=0; x<data.Staff.length; x++){
                        
                        console.log("x:"+x);
                        
                        var ids_str = data.Staff[x].StaffData;
                        
                        console.log("ids_str:"+ids_str);
                        
                        try{
                            var ids = ids_str.split(",");

                            console.log("ids:"+ids)

                            var pstaffid = ids[0];
                            var pname = ids[1];
                            console.log("pstaffid["+pstaffid+"] pname["+pname+"] "+tempStaffGroup[pstaffid]);

                            if(tempStaffGroup[pstaffid] == undefined){
                                tempStaffGroup[pstaffid] = pname;

                                var htmlstr = "<tr id=\"grpR"+pstaffid+"\" class=\"odd gradeX\"><td>"+pname+"</td><td><button type=\"button\" class=\"btn btn-danger col-xs-12\" onclick=\'remove("+pstaffid+")\' >Delete</button></td></tr>";
                                $("#tstaffIfdGroup").append(htmlstr);
                            }
                        }catch(err){}

                    }





                }); 
                
                
                
                
                
            }
            
            function vaDelete(x) {
//                   console.log("Delete this row and the ID is:" + x);
                   $('#tmpGetID').val(x);
                   $('#getID').val(x);
                   
                   OperationDwr.deletSMSGroups(x, function() {
                        location.reload();
                    });
                   
                }
                
                
            function deleteRecord() {
                    var thisNatId = document.getElementById("getID").value;
                     console.log('thisNatId:'+thisNatId);
                    
//                                        console.log(thisNatId);

//                    OperationDwr.sendSMS("94518865","Test SMS", function(){
////                        alert("Delete Successful"); 
////                        window.location.reload();
//                     });
                     
                     
                    OperationDwr.deletSMSGroups(thisNatId, function(){
                        alert("Delete Successful"); 
                        window.location.reload();
                     });

                }
            
            $("#idAdd").click(function() {
                $('#thisForm').bootstrapValidator('validate', true);
                console.log('Add this to the Table Below');
            });
            
            
            function loadStaff(  ){
                                    
                var designation = $('#designation').val();

                OperationDwr.getStaffByDesignation(designation, function (data) {

                    console.log( "datalen:"+data.length );

                    if (data != 0){                                           
                        var sel = $("#pName");
                        sel.empty();
                        sel.append('<option value="">---Select Staff---</option>');
                        for (var i=0; i<data.length; i++) {
                          sel.append('<option value="' + data[i].StaffID + '">' + data[i].Name + '</option>');
                        }
                    } else {
                        var sel = $("#pName");
                        sel.empty();
                        sel.append('<option value="">---Select Staff---</option>');
                    }

                });
            }
            
            
            function addStaffToGroup(){
                
                var size = Object.keys(tempStaffGroup).length;
                console.log("size:"+size);
                if(size==0){
                    $("#datatables-nameList").find('tbody').empty(); 
                    $("#tstaffIfdGroup").empty();
                }
                
                
                var pstaffid = $('#pName').val();
                var pname = $('#pName option:selected').text();
                console.log("pstaffid["+pstaffid+"] pname["+pname+"] "+tempStaffGroup[pstaffid]);
                
                if(tempStaffGroup[pstaffid] == undefined){
                    tempStaffGroup[pstaffid] = pname;

                    var htmlstr = "<tr id=\"grpR"+pstaffid+"\" class=\"odd gradeX\"><td>"+pname+"</td><td><button type=\"button\" class=\"btn btn-danger col-xs-12\" onclick=\'remove("+pstaffid+")\' >Delete</button></td></tr>";
                    $("#tstaffIfdGroup").append(htmlstr);
                }
            }
            
            
            function remove(id){                
                $('#grpR'+id).remove();                
                delete tempStaffGroup[id]; 
            }
            
            
        
            
            
            
            //$("#tstaffIfdGroup").empty();
//             tstaffIfdGroup
//            <tr class="odd gradeX"><td>lorem ipsum</td><td><button type = "button" class = "btn btn-danger col-xs-12">Delete</button></td></tr>
            
            
            
            
//            function saveSMSGroup(smsGroupsID){
//                
//                try{
//    //               void saveSMSGroups( int smsGroupId, String groupName, String groupLevel, String remarks, String staffId, boolean isDeleted  ) 
//               
//                    OperationDwr.deletSMSGroups(smsGroupsID, function (data) {
//
//                    });
//                }catch(err){
//                    console.log("DWR-deletSMSGroups:ERROR:"+err)
//                } 
//            }
            
            
            function saveSMSGroup(){
                
                console.log("==============================================");
                console.log("   ++++++++++++++++++++++++++++++++++++++     "); 
                var staffIds = "";
                for (var key in tempStaffGroup) {
                    if (tempStaffGroup.hasOwnProperty(key)) {
                        
                        if(staffIds==""){
                            staffIds = key;
                        }else{
                            staffIds = staffIds+"|"+key;
                        }
                        
                       console.log('key['+key+'] value['+tempStaffGroup[key]+']');
                    }
                 }
                 
                console.log("   ++++++++++++++++++++++++++++++++++++++     "); 
                console.log("=============================================="); 
                console.log("["+( $("#gpName").val() )+"]"); 
                console.log("["+( $("input[name='radiolevel']:checked").val() )+"]"); 
                console.log("["+staffIds+"]"); 
                console.log("==============================================");  
                 
                 var grpName = $("#gpName").val();
                 var level = $("input[name='radiolevel']:checked").val();
                 
               try{
    //               void saveSMSGroups( int smsGroupId, String groupName, String groupLevel, String remarks, String staffId, boolean isDeleted  ) 
                    if($("#grpId").val()=="" ){
                        OperationDwr.saveSMSGroups(0, grpName, level, '', staffIds, false, function (data) {
                            location.reload();
                        });
                    }else{
                        OperationDwr.saveSMSGroups(eval($("#grpId").val()), grpName, level, '', staffIds, false, function (data) {
                            location.reload();
                        });
                    }
                }catch(err){
                    console.log("DWR-saveSMSGroups:ERROR:"+err)
                }  
                 
                 
                 
            }
            
            
           
        /*]]>*/
    </script>

    <!-- end script -->
</body>

</html>

